<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Lucky Dice 3D (No Flatten)</title>

    <style>
        *{ box-sizing:border-box; }
        html,body{ height:100%; margin:0; }

        /* ===== Background curtain ===== */
        body{
            display:flex;
            align-items:center;
            justify-content:center;
            background:
                    radial-gradient(900px 520px at 50% 45%, rgba(0,0,0,.45), rgba(0,0,0,.88)),
                    repeating-linear-gradient(90deg,#2b0007 0 14px,#3b0010 14px 28px);
            overflow:hidden;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
        }

        /* ===== Round stage board ===== */
        .board{
            width: min(980px, 94vw);
            aspect-ratio: 4 / 3;
            border-radius: 999px;
            display:flex;
            align-items:center;
            justify-content:center;
            position:relative;

            background:
                    radial-gradient(circle at 50% 45%, rgba(255,255,255,.06), rgba(0,0,0,.35)),
                    radial-gradient(circle at 50% 50%, rgba(255,255,255,.06), transparent 65%);

            box-shadow:
                    0 40px 100px rgba(0,0,0,.72),
                    inset 0 0 0 10px rgba(255,255,255,.05),
                    inset 0 0 0 2px rgba(255,255,255,.08);
        }

        .row{
            display:flex;
            gap: 74px;
            align-items:center;
            justify-content:center;
            transform: translateY(-6px);
        }

        /* ===== Perspective wrapper ===== */
        .scene{
            width: 150px;
            height: 150px;
            perspective: 1200px;
            perspective-origin: 50% 35%;
            overflow: visible;
            position: relative;
        }

        /* ✅ Shadow on wrapper (NOT on cube) to avoid flatten */
        .scene::after{
            content:"";
            position:absolute;
            inset:-18px;
            border-radius: 26px;
            box-shadow: 0 30px 55px rgba(0,0,0,.65);
            pointer-events:none;
        }

        .cube{
            width:100%;
            height:100%;
            position:relative;

            transform-style: preserve-3d;
            -webkit-transform-style: preserve-3d;

            /* always show multiple faces */
            transform: rotateX(-28deg) rotateY(35deg);
            -webkit-transform: rotateX(-28deg) rotateY(35deg);

            /* ❌ DO NOT use filter here */
        }

        .face{
            position:absolute;
            inset:0;
            border-radius: 18px;

            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;

            /* white plastic material */
            background:
                    radial-gradient(circle at 30% 25%, #ffffff 0%, #f3f3f3 55%, #e3e3e3 100%);

            /* bevel + depth */
            box-shadow:
                    inset 0 0 0 2px rgba(0,0,0,.12),
                    inset 0 14px 22px rgba(255,255,255,.55),
                    inset 0 -18px 24px rgba(0,0,0,.22);
        }

        /* glossy highlight */
        .face::before{
            content:"";
            position:absolute;
            inset: 10px;
            border-radius: 14px;
            background: linear-gradient(135deg, rgba(255,255,255,.78), rgba(255,255,255,0) 55%);
            opacity:.55;
            pointer-events:none;
        }

        /* half size = 150/2 */
        :root{ --z: 75px; }

        .front  { transform: translateZ(var(--z)); filter: brightness(1.00); }
        .right  { transform: rotateY(90deg)  translateZ(var(--z)); filter: brightness(.94); }
        .left   { transform: rotateY(-90deg) translateZ(var(--z)); filter: brightness(.90); }
        .back   { transform: rotateY(180deg) translateZ(var(--z)); filter: brightness(.86); }
        .top    { transform: rotateX(90deg)  translateZ(var(--z)); filter: brightness(1.06); }
        .bottom { transform: rotateX(-90deg) translateZ(var(--z)); filter: brightness(.82); }

        /* ===== Pips ===== */
        .pip{
            width: 18px;
            height: 18px;
            border-radius: 999px;
            background: #b51212;
            position:absolute;
            box-shadow:
                    inset 0 3px 6px rgba(255,255,255,.25),
                    inset 0 -4px 9px rgba(0,0,0,.35);
        }

        .p1{ left:22%; top:22%; }
        .p2{ left:50%; top:22%; transform:translateX(-50%); }
        .p3{ right:22%; top:22%; }
        .p4{ left:22%; top:50%; transform:translateY(-50%); }
        .p5{ left:50%; top:50%; transform:translate(-50%,-50%); }
        .p6{ right:22%; top:50%; transform:translateY(-50%); }
        .p7{ left:22%; bottom:22%; }
        .p8{ left:50%; bottom:22%; transform:translateX(-50%); }
        .p9{ right:22%; bottom:22%; }

        .hint{
            position:absolute;
            bottom: 22px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 14px;
            border-radius: 999px;
            background: rgba(0,0,0,.35);
            border: 1px solid rgba(255,255,255,.18);
            color: rgba(255,255,255,.92);
            font-weight: 900;
            letter-spacing: .08em;
            user-select:none;
        }

        .small{
            opacity:.78;
            font-weight:700;
            letter-spacing:0;
            margin-left:8px;
            font-size: 12px;
        }
    </style>
</head>

<body>
<div class="board" id="board">
    <div class="row">
        <div class="scene"><div class="cube" id="c1"></div></div>
        <div class="scene"><div class="cube" id="c2"></div></div>
        <div class="scene"><div class="cube" id="c3"></div></div>
    </div>
    <div class="hint">SPACE: QUAY / DỪNG <span class="small">(click nền cũng được)</span></div>
</div>

<script>
    // ----- Pips per face -----
    const PIPS = {
        1:['p5'],
        2:['p1','p9'],
        3:['p1','p5','p9'],
        4:['p1','p3','p7','p9'],
        5:['p1','p3','p5','p7','p9'],
        6:['p1','p3','p4','p6','p7','p9'],
    };

    // Face mapping (opposites: 1-6, 2-5, 3-4)
    const FACE_NUM = { front:1, back:6, right:3, left:4, top:2, bottom:5 };
    const FACE_ORDER = ['front','right','left','back','top','bottom'];

    function makeFace(name, num){
        const f = document.createElement('div');
        f.className = `face ${name}`;
        (PIPS[num] || []).forEach(p=>{
            const dot = document.createElement('span');
            dot.className = `pip ${p}`;
            f.appendChild(dot);
        });
        return f;
    }

    function buildCube(el){
        el.innerHTML = '';
        FACE_ORDER.forEach(name=>{
            el.appendChild(makeFace(name, FACE_NUM[name]));
        });
    }

    const cubes = [
        document.getElementById('c1'),
        document.getElementById('c2'),
        document.getElementById('c3'),
    ];
    cubes.forEach(buildCube);

    // ----- Spin engine (fast multi-axis) -----
    const state = cubes.map((el,i)=>({
        el,
        rx: -28 + i*6,
        ry:  35 + i*10,
        rz:  0,
        vx: 0, vy: 0, vz: 0,
        spin: false,
    }));

    function apply(d){
        d.el.style.transform = `rotateX(${d.rx}deg) rotateY(${d.ry}deg) rotateZ(${d.rz}deg)`;
    }

    function randVel(){
        const s = () => (Math.random() > 0.5 ? 1 : -1);
        return {
            vx: s() * (16 + Math.random()*30),
            vy: s() * (18 + Math.random()*34),
            vz: s() * (12 + Math.random()*26),
        };
    }

    function start(){
        state.forEach(d=>{
            const v = randVel();
            d.vx = v.vx; d.vy = v.vy; d.vz = v.vz;
            d.spin = true;
        });
    }

    function stop(){
        state.forEach(d => d.spin = false);
    }

    function tick(){
        state.forEach(d=>{
            if(d.spin){
                if(Math.random() < 0.03){
                    const v = randVel();
                    d.vx = v.vx; d.vy = v.vy; d.vz = v.vz;
                }
                d.rx += d.vx;
                d.ry += d.vy;
                d.rz += d.vz;
            }
            apply(d);
        });
        requestAnimationFrame(tick);
    }
    tick();

    // ----- Controls -----
    let running = false;
    function toggle(){
        running = !running;
        running ? start() : stop();
    }

    document.addEventListener('keydown', (e)=>{
        if(e.code !== 'Space') return;
        e.preventDefault();
        toggle();
    });

    document.getElementById('board').addEventListener('click', toggle);
</script>
</body>
</html>
